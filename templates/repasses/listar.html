{% extends "base.html" %}

{% block title %}Repasses Financeiros - Conecta Uniforme{% endblock %}

{% block content %}
<h2 class="mb-4"><i class="bi bi-currency-dollar"></i> Repasses Financeiros</h2>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Fornecedor</th>
                        <th>Pedido</th>
                        <th>Valor Bruto</th>
                        <th>Taxa ({{ "%.1f"|format(5.0) }}%)</th>
                        <th>Valor Líquido</th>
                        <th>Status</th>
                        <th>Data</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for repasse in repasses %}
                    <tr>
                        <td>{{ repasse.id }}</td>
                        <td>{{ repasse.fornecedor_nome or repasse.nome }}</td>
                        <td>{{ repasse.pedido_id or '-' }}</td>
                        <td>R$ {{ "%.2f"|format(repasse.valor) }}</td>
                        <td>R$ {{ "%.2f"|format(repasse.taxa_plataforma) }}</td>
                        <td><strong>R$ {{ "%.2f"|format(repasse.valor_liquido) }}</strong></td>
                        <td>
                            {% if repasse.status == 'pendente' %}
                            <span class="badge bg-warning">Pendente</span>
                            {% elif repasse.status == 'processando' %}
                            <span class="badge bg-info">Processando</span>
                            {% elif repasse.status == 'concluido' %}
                            <span class="badge bg-success">Concluído</span>
                            {% elif repasse.status == 'cancelado' %}
                            <span class="badge bg-danger">Cancelado</span>
                            {% endif %}
                        </td>
                        <td>{{ repasse.data_repasse.strftime('%d/%m/%Y') if repasse.data_repasse else '-' }}</td>
                        <td>
                            {% if usuario_logado.tipo == 'administrador' and repasse.status == 'pendente' %}
                            <form method="POST" action="{{ url_for('repasses.processar', id=repasse.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-success" title="Processar">
                                    <i class="bi bi-check-circle"></i>
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('repasses.cancelar', id=repasse.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" title="Cancelar">
                                    <i class="bi bi-x-circle"></i>
                                </button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center">Nenhum repasse encontrado</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
