# Conecta Uniforme

Sistema completo de e-commerce para venda de uniformes escolares com foco em gest√£o de m√∫ltiplos perfis de usu√°rios, cat√°logo personalizado e comissionamento.

## üìã √çndice

- [Sobre o Sistema](#sobre-o-sistema)
- [Funcionalidades](#funcionalidades)
- [Requisitos](#requisitos)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Estrutura do Banco de Dados](#estrutura-do-banco-de-dados)
- [Fluxo Operacional](#fluxo-operacional)
- [Perfis de Usu√°rio](#perfis-de-usu√°rio)
- [Integra√ß√£o Mailersend](#integra√ß√£o-mailersend)

## üéØ Sobre o Sistema

O **Conecta Uniforme** √© uma plataforma que conecta escolas, fornecedores de uniformes e respons√°veis (pais/alunos), facilitando o processo de compra de uniformes escolares atrav√©s de um sistema de "clique e retire". 

### Principais Diferenciais

- **Login sem senha**: Autentica√ß√£o via c√≥digo tempor√°rio enviado por e-mail
- **Cat√°logo personalizado**: Cada respons√°vel v√™ apenas os uniformes da s√©rie e g√™nero do seu aluno
- **Homologa√ß√£o de fornecedores**: Escolas controlam quais fornecedores podem vender para seus alunos
- **Comissionamento autom√°tico**: 15% de comiss√£o calculada automaticamente em cada venda
- **Gest√£o de estoque**: Controle de varia√ß√µes (tamanho, cor, g√™nero) por produto

## ‚ú® Funcionalidades

### Login e Autentica√ß√£o
- Login via e-mail com c√≥digo de acesso tempor√°rio (10 minutos de validade)
- Integra√ß√£o com API Mailersend para envio de c√≥digos
- Possibilidade de solicitar novo c√≥digo

### Gest√£o de Usu√°rios
- **Gestor Escolar**: Cadastrado pela equipe administrativa
- **Fornecedor**: Cadastrado pela equipe administrativa
- **Respons√°vel**: Auto-cadastro simplificado com valida√ß√£o via lista escolar

### Gest√£o de Produtos (Fornecedor)
- Cadastro de uniformes com fotos, descri√ß√£o e pre√ßo
- Defini√ß√£o de varia√ß√µes (tamanho, cor, g√™nero)
- Homologa√ß√£o para escolas e s√©ries espec√≠ficas
- Controle de estoque por varia√ß√£o
- Ativa√ß√£o/desativa√ß√£o tempor√°ria de produtos

### Gest√£o Escolar
- Importa√ß√£o de lista de alunos (individual ou CSV)
- Habilita√ß√£o/desabilita√ß√£o de fornecedores
- Visualiza√ß√£o de pedidos da escola
- Gerenciamento de ponto de coleta

### Cat√°logo e Compras (Respons√°vel)
- Visualiza√ß√£o autom√°tica de produtos da s√©rie e g√™nero do aluno
- Detalhamento de produtos com fotos e descri√ß√£o
- Carrinho de compras com atualiza√ß√£o de quantidades
- Finaliza√ß√£o com retirada na escola (clique e retire)
- Acompanhamento de status dos pedidos

### Gest√£o de Pedidos
- Atualiza√ß√£o de status pelo fornecedor:
  - Pendente ‚Üí Aprovado ‚Üí Em Produ√ß√£o ‚Üí Pronto para Retirada ‚Üí Entregue
- Visualiza√ß√£o por perfil (respons√°vel, fornecedor, gestor)
- Detalhamento completo de itens do pedido

### Relat√≥rios e Comiss√µes
- C√°lculo autom√°tico de 15% de comiss√£o por venda
- Gera√ß√£o de relat√≥rios mensais por fornecedor
- Detalhamento de vendas do per√≠odo
- Registro de pagamentos pela administra√ß√£o

## üîß Requisitos

- PHP 7.4 ou superior
- MySQL 5.7 ou superior
- Servidor web (Apache/Nginx)
- Extens√µes PHP:
  - mysqli
  - curl (para integra√ß√£o Mailersend)
  - json

## üì¶ Instala√ß√£o

### 1. Clone ou baixe o reposit√≥rio

```bash
cd /caminho/do/servidor/web
# Extrair arquivos do projeto
```

### 2. Criar o banco de dados

Execute o arquivo `bd.sql` no MySQL:

```bash
mysql -u root -p < bd.sql
```

Ou pelo phpMyAdmin:
- Acesse o phpMyAdmin
- Crie um banco chamado `conecta_uniformes`
- Importe o arquivo `bd.sql`

### 3. Configurar conex√£o com banco de dados

Edite o arquivo `conexao.php`:

```php
<?php
try {
    if ($con = new mysqli("localhost", "seu_usuario", "sua_senha", "conecta_uniformes")) {
        // Conex√£o estabelecida
    } else {
        throw new Exception();
    }
}
catch(Exception $e) {
    $con = new mysqli("localhost", "seu_usuario", "sua_senha", "conecta_uniformes");
}
```

### 4. Configurar o arquivo .htaccess

Renomeie `htaccess.txt` para `.htaccess` e ajuste se necess√°rio.

### 2. Configura√ß√£o do Ambiente (.env)

### Configura√ß√£o do Mailersend

#### 1. Criar conta no Mailersend

Acesse [Mailersend](https://www.mailersend.com/) e crie uma conta gratuita.

#### 2. Obter API Key

- No painel do Mailersend, v√° em **API Tokens**
- Clique em **Generate new token**
- D√™ um nome descritivo (ex: "Conecta Uniforme")
- Copie a API Key gerada

#### 3. Configurar no sistema

Edite o arquivo `classes/CodigoAcesso.php` na linha 12:

```php
$this->mailersendApiKey = 'sua_api_key_aqui';
```

**Recomenda√ß√£o**: Para ambientes de produ√ß√£o, use vari√°veis de ambiente:

No seu servidor, defina a vari√°vel:
```bash
export MAILERSEND_API_KEY="mlsn.sua_chave_aqui"
```

O c√≥digo j√° est√° preparado para ler a vari√°vel de ambiente:
```php
$this->mailersendApiKey = getenv('MAILERSEND_API_KEY') ?: 'sua_chave_api_aqui';
```

#### 4. Verificar dom√≠nio de envio

No painel do Mailersend:
- Adicione e verifique seu dom√≠nio de envio
- Atualize o e-mail remetente em `classes/CodigoAcesso.php` (linha 89):

```php
'from' => [
    'email' => 'noreply@seudominio.com.br',
    'name' => 'Conecta Uniforme'
],
```

## 8. Primeiros Passos

### Principais Tabelas

- **escola**: Dados das institui√ß√µes de ensino
- **gestor**: Gestores escolares vinculados √†s escolas
- **fornecedor**: Fornecedores de uniformes
- **homologacao**: V√≠nculo entre escolas e fornecedores autorizados
- **aluno**: Alunos cadastrados por escola
- **responsavel**: Respons√°veis vinculados aos alunos
- **codigo_acesso**: C√≥digos tempor√°rios para login
- **produto**: Uniformes cadastrados pelos fornecedores
- **produto_foto**: Fotos dos produtos
- **produto_homologacao**: Produtos homologados por escola/s√©rie
- **produto_variacao**: Varia√ß√µes de produtos (tamanho, cor, g√™nero)
- **carrinho**: Carrinho tempor√°rio dos respons√°veis
- **pedido**: Pedidos finalizados
- **pedido_item**: Itens de cada pedido
- **comissao**: Relat√≥rios mensais de comiss√£o por fornecedor
- **auditoria**: Log autom√°tico de altera√ß√µes

## üìä Fluxo Operacional

### 1. Configura√ß√£o Inicial (Administra√ß√£o)

1. Cadastrar escolas no banco de dados
2. Cadastrar gestores escolares vinculados √†s escolas
3. Cadastrar fornecedores no sistema

### 2. Gest√£o Escolar

1. Gestor faz login com e-mail cadastrado
2. Recebe c√≥digo por e-mail e valida
3. Importa lista de alunos (CSV ou individual)
4. Habilita fornecedores para vender na escola
5. Monitora pedidos e ponto de coleta

### 3. Gest√£o do Fornecedor

1. Fornecedor faz login com e-mail cadastrado
2. Recebe c√≥digo por e-mail e valida
3. Cadastra produtos com fotos e descri√ß√£o
4. Define varia√ß√µes (tamanhos, cores, g√™neros)
5. Homologa produtos para escolas/s√©ries
6. Atualiza estoque conforme necess√°rio
7. Recebe pedidos e atualiza status
8. Visualiza relat√≥rios financeiros

### 4. Compra pelo Respons√°vel

1. Respons√°vel se cadastra informando dados b√°sicos e v√≠nculo com aluno
2. Faz login digitando e-mail
3. Recebe c√≥digo por e-mail e valida
4. Acessa cat√°logo personalizado (apenas produtos da s√©rie e g√™nero do aluno)
5. Adiciona produtos ao carrinho
6. Finaliza pedido (retirada na escola)
7. Acompanha status do pedido

### 5. Comissionamento

1. Sistema calcula automaticamente 15% de comiss√£o em cada venda
2. No final do m√™s, administrador gera relat√≥rio de comiss√µes
3. Visualiza total de vendas, comiss√£o e valor l√≠quido por fornecedor
4. Registra data e valor do pagamento realizado

## üë• Perfis de Usu√°rio

### Gestor Escolar

**Acesso**: `/conecta-uniforme/login-novo` (tipo: gestor)

**Funcionalidades**:
- Gerenciar lista de alunos
- Habilitar/desabilitar fornecedores
- Visualizar pedidos da escola
- Monitorar ponto de retirada

**Rotas**:
- Dashboard: `/dashboard-gestor`
- Alunos: `/alunos-gestor`
- Pedidos: `/pedidos-gerenciar`

### Fornecedor

**Acesso**: `/conecta-uniforme/login-novo` (tipo: fornecedor)

**Funcionalidades**:
- Cadastrar e gerenciar produtos
- Definir varia√ß√µes e estoque
- Homologar produtos para escolas
- Atualizar status de pedidos
- Visualizar relat√≥rios financeiros

**Rotas**:
- Dashboard: `/dashboard-fornecedor`
- Produtos: `/produtos-fornecedor`
- Pedidos: `/pedidos-gerenciar`
- Comiss√µes: `/comissoes-relatorio`

### Respons√°vel (Pai/M√£e)

**Acesso**: `/conecta-uniforme/login-novo` (tipo: responsavel)

**Funcionalidades**:
- Visualizar cat√°logo personalizado
- Adicionar produtos ao carrinho
- Finalizar pedidos
- Acompanhar status de pedidos

**Rotas**:
- Dashboard: `/dashboard-responsavel`
- Cat√°logo: `/catalogo-novo`
- Carrinho: `/carrinho-novo`
- Meus Pedidos: `/pedidos-gerenciar`

## üîê Integra√ß√£o Mailersend

### Funcionamento do Sistema de Login

1. Usu√°rio digita e-mail e seleciona tipo (gestor/fornecedor/respons√°vel)
2. Sistema verifica se e-mail existe e est√° ativo
3. Gera c√≥digo alfanum√©rico de 6 caracteres
4. Envia c√≥digo via API do Mailersend
5. C√≥digo expira em 10 minutos
6. Usu√°rio digita c√≥digo recebido
7. Sistema valida e cria sess√£o

### C√≥digo de Exemplo

```php
// Gerar c√≥digo
$codigo = $codigoAcesso->criarCodigo($email, $tipo_usuario);

// Enviar por email
$enviado = $codigoAcesso->enviarCodigoPorEmail($email, $codigo['codigo'], $nome);

// Validar c√≥digo
$validacao = $codigoAcesso->validarCodigo($email, $codigo_digitado);
```

### Troubleshooting Mailersend

**Erro: Email n√£o enviado**
- Verifique se a API Key est√° correta
- Confirme se o dom√≠nio est√° verificado no Mailersend
- Verifique limites da conta (plano gratuito tem limite de envios)

**Erro: Email na caixa de spam**
- Configure SPF, DKIM e DMARC no seu dom√≠nio
- Use um dom√≠nio verificado e com boa reputa√ß√£o

## üöÄ Primeiros Passos

### 1. Inserir dados iniciais

```sql
-- Inserir escola
INSERT INTO escola (email, nome, cnpj, telefone, ativo) 
VALUES ('escola@exemplo.com', 'Escola Exemplo', '12345678000190', '(11) 1234-5678', 1);

-- Inserir gestor
INSERT INTO gestor (nome, email, telefone, escola_id, ativo) 
VALUES ('Jo√£o Silva', 'gestor@exemplo.com', '(11) 9 1234-5678', 1, 1);

-- Inserir fornecedor
INSERT INTO fornecedor (nome, email, telefone, cnpj, ativo) 
VALUES ('Uniformes XYZ', 'fornecedor@xyz.com', '(11) 9 8765-4321', '98765432000190', 1);
```

### 2. Habilitar fornecedor para escola

```sql
-- Criar homologa√ß√£o
INSERT INTO homologacao (escola_id, fornecedor_id, ativo) 
VALUES (1, 1, 1);
```

### 3. Importar alunos

Crie um arquivo CSV com formato:
```
nome,matricula,serie,genero,responsavel_nome,responsavel_email,responsavel_telefone
Maria Silva,2024001,5¬∫ Ano,feminino,Ana Silva,ana@email.com,(11) 91234-5678
Jo√£o Santos,2024002,5¬∫ Ano,masculino,Carlos Santos,carlos@email.com,(11) 98765-4321
```

Fa√ßa upload via interface do gestor em `/alunos-gestor`.

### 4. Fazer primeiro login

1. Acesse `/conecta-uniforme/login-novo`
2. Digite o e-mail do gestor/fornecedor
3. Receba o c√≥digo por e-mail
4. Digite o c√≥digo e acesse o sistema

## üìù Notas Importantes

- **Sem estilo CSS**: As interfaces foram criadas SEM estiliza√ß√£o para que outra pessoa possa aplicar o design
- **Seguran√ßa**: Em produ√ß√£o, use HTTPS e configure adequadamente as vari√°veis de ambiente
- **Estoque**: O sistema deduz automaticamente o estoque ao finalizar pedidos
- **Comiss√£o**: Sempre 15% sobre o valor total da venda
- **Modalidade**: Sistema preparado apenas para "clique e retire" (sem entrega/frete)

## üêõ Resolu√ß√£o de Problemas

### Erro de conex√£o com banco
- Verifique credenciais em `conexao.php`
- Confirme se o banco `conecta_uniformes` existe
- Verifique se o MySQL est√° rodando

### C√≥digo de acesso n√£o chega
- Confirme configura√ß√£o do Mailersend
- Verifique caixa de spam
- Teste API Key no painel do Mailersend

### Produtos n√£o aparecem no cat√°logo
- Verifique se fornecedor est√° homologado para a escola
- Confirme se produto est√° homologado para a s√©rie correta
- Verifique se existem varia√ß√µes com estoque para o g√™nero do aluno

## üìÑ Licen√ßa

Sistema desenvolvido para fins educacionais e comerciais.

## üë®‚Äçüíª Suporte

Para d√∫vidas e suporte, entre em contato com a equipe de desenvolvimento.
